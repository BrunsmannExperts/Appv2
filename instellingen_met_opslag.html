<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Instellingen</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/config.js"></script>
  <script src="/js/app.js"></script>
  <style>
    nav a {
      margin-right: 10px;
      cursor: pointer;
      font-weight: bold;
    }
    .tabcontent {
      display: none;
      margin-top: 20px;
    }
    .tabcontent.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Instellingen</h1>
  <nav>
    <a onclick="openTab('gebruikers')">Gebruikers</a>
    <a onclick="openTab('rapport')">Rapportstructuur</a>
    <a onclick="openTab('opmaak')">Opmaak</a>
    <a onclick="openTab('opslag')">Opslag</a>
  </nav>

  <div id="gebruikers" class="tabcontent">
    <h2>Gebruikersbeheer</h2>
    <p>(Reeds gebouwd, behouden)</p>
  </div>

  <div id="rapport" class="tabcontent">
    <h2>Excel Upload ‚Äì Rapportstructuur</h2>
    <p>(Reeds gebouwd, behouden)</p>
  </div>

  <div id="opmaak" class="tabcontent">
    <h2>Opmaak & Thema</h2>
    <p>(Reeds gebouwd, behouden)</p>
  </div>

  <div id="opslag" class="tabcontent">
    <h2>Opslaginstellingen (Supabase)</h2>
    <label>Supabase Project URL:<br>
      <input type="text" id="supabaseUrl" style="width: 100%;">
    </label><br><br>
    <label>Supabase API Key:<br>
      <input type="password" id="supabaseKey" style="width: 100%;">
    </label><br><br>
    <label>Standaard opslagmap:<br>
      <input type="text" id="defaultFolder" value="rapporten/" style="width: 100%;">
    </label><br><br>
    <button onclick="opslaanOpslagInstellingen()">üíæ Opslaan instellingen</button>
    <button onclick="checkOpslag()">üîÅ Check verbinding</button>
    <p id="opslagStatus"></p>
  </div>

  <script>
    function openTab(tabName) {
      document.querySelectorAll('.tabcontent').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
    }

    // Standaard eerste tab openen
    openTab('gebruikers');

    // Opslaginstellingen opslaan en laden
    function opslaanOpslagInstellingen() {
      const instellingen = {
        url: document.getElementById("supabaseUrl").value,
        key: document.getElementById("supabaseKey").value,
        folder: document.getElementById("defaultFolder").value
      };
      localStorage.setItem("supabase_config", JSON.stringify(instellingen));
      alert("‚úÖ Opgeslagen!");
    }

    function laadOpslagInstellingen() {
      const config = JSON.parse(localStorage.getItem("supabase_config"));
      if (!config) return;
      document.getElementById("supabaseUrl").value = config.url || "";
      document.getElementById("supabaseKey").value = config.key || "";
      document.getElementById("defaultFolder").value = config.folder || "rapporten/";
    }

    async function checkOpslag() {
      const config = JSON.parse(localStorage.getItem("supabase_config"));
      if (!config?.url || !config?.key) {
        document.getElementById("opslagStatus").textContent = "‚ùå Vul eerst de instellingen in.";
        return;
      }

      try {
        const response = await fetch(`${config.url}/rest/v1/`, {
          method: "GET",
          headers: {
            apikey: config.key,
            Authorization: "Bearer " + config.key
          }
        });
        if (response.ok) {
          document.getElementById("opslagStatus").textContent = "‚úÖ Verbonden met Supabase.";
        } else {
          document.getElementById("opslagStatus").textContent = "‚ùå Geen verbinding mogelijk.";
        }
      } catch (err) {
        document.getElementById("opslagStatus").textContent = "‚ùå Fout bij verbinden: " + err.message;
      }
    }

    document.addEventListener("DOMContentLoaded", laadOpslagInstellingen);
  </script>
</body>
</html>
